<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8" />
    <title>Perfil vendedor</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta content="Premium Multipurpose Admin & Dashboard Template" name="description">
    <meta content="Themesbrand" name="author">
    <!-- App favicon -->
    <link rel="shortcut icon" href="../directorio_perfilClientes/images/favicon.png">
    <link rel="stylesheet" type="text/css" href="../css/colors.min.css">

    <base href="#">
 <!-- Responsive Table css -->
<link href="../directorio_dash/libs/admin-resources/rwd-table/rwd-table.min.css" rel="stylesheet" type="text/css" />

<!-- App favicon -->
<link rel="shortcut icon" href="./directorio_perfilClientes/images/favicon.png">

<!-- preloader css -->
<link rel="stylesheet" href="../directorio_dash/css/preloader.min.css" type="text/css" />

<!-- Bootstrap Css -->
<link href="../directorio_dash/css/bootstrap.min-admin.css" id="bootstrap-style" rel="stylesheet" type="text/css" />
 <!-- Icons Css -->
<link href="../directorio_dash/css/icons.min.css" rel="stylesheet" type="text/css" />
<!-- App Css-->
<link href="../directorio_dash/css/app.min.css" id="app-style" rel="stylesheet" type="text/css" />
<link rel="stylesheet" href="../css/typeFont.css" type="text/css" />
<!-- scroll -->
<link rel="stylesheet" href="../css/scrolls.css">
<link href="../directorio_dash/libs/sweetalert2/sweetalert2.min.css" rel="stylesheet" type="text/css" />

    </head>

    <body>

    <!-- <body data-layout="horizontal"> -->

        <!-- Begin page -->
        <div id="layout-wrapper">

           
         <!-- =======FIXME: MENU ========================== -->
         <%- include ('./partials/menu.ejs')%>
         <!-- =======FIXME: MENU ========================== -->
 

            <!-- ============================================================== -->
            <!-- Start right Content here -->
            <!-- ============================================================== -->
            <div class="main-content">

                <div class="page-content">
                    <div class="container-fluid">

                        <!-- start page title -->
                        <div class="row">
                            <div class="col-12">
                                <div class="page-title-box d-sm-flex align-items-center justify-content-between">
                                    <h4 class="mb-sm-0 font-size-18">Perfil del vendedor</h4>

                                    <div class="page-title-right">
                                        <ol class="breadcrumb m-0">
                                            <li class="breadcrumb-item"><a href="javascript: void(0);">Vendedores</a></li>
                                            <li class="breadcrumb-item active">Perfil del vendedor</li>
                                        </ol>
                                    </div>

                                </div>
                            </div>
                        </div>
                        <!-- end page title -->

                        <div class="row">
                            <div class="col-xl-9 col-lg-8">
                                <div class="card">
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-sm order-2 order-sm-1">
                                                <div class="d-flex align-items-start mt-3 mt-sm-0">
                                                    <div class="flex-shrink-0">
                                                        <div class="avatar-xl me-3">
                                                            <img src="../directorio_dash/images/users/avatar-2.jpg" alt="" class="img-fluid rounded-circle d-block">
                                                        </div>
                                                    </div>
                                                    <div class="flex-grow-1">
                                                            <h5 class="font-size-16 mb-1" style="text-transform: capitalize;"><%= user.nombres%> <%= user.apellidos %> </h5>
                                                            <!-- <p class="text-muted font-size-13">Id: <b style="font-weight:600 ;"> <= user.id_vendedor %></b></p> -->

                                                            <!-- <div class="d-flex flex-wrap align-items-start gap-2 gap-lg-3 text-muted font-size-13">
                                                                <div><i class="mdi mdi-circle-medium me-1 text-success align-middle"></i>aqui va el telefono</div>
                                                                <div><i class="mdi mdi-circle-medium me-1 text-success align-middle"></i>aqui va el correo</div>
                                                            </div> -->
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-sm-auto order-1 order-sm-2">
                                                <div class="d-flex align-items-start justify-content-end gap-2">
                                                <button class="btn btn-primary" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasRight" 
                                                aria-controls="offcanvasRight" style=" border-radius: 15px;">Editar informacion</button>
                                             </div>
                                            </div>
                                        </div>
                                        <br>
                                          <div class="row justify-content-center">
                                              <div class="col-xl-6">
                                                 <ul class="nav nav-pills nav-justified" role="tablist">
                                                 <li class="nav-item waves-effect waves-light">
                                                     <a class="nav-link active" data-bs-toggle="tab" href="#home-1" role="tab">
                                                         <span class="d-block d-sm-none"><i class="fas fa-home"></i></span>
                                                         <span class="d-none d-sm-block">información personal</span> 
                                                     </a>
                                                 </li>
                                                 <li class="nav-item waves-effect waves-light" >
                                                     <a class="nav-link active" data-bs-toggle="tab" href="#profile-1" role="tab">
                                                         <span class="d-block d-sm-none"><i class="far fa-user"></i></span>
                                                         <span class="d-none d-sm-block">información bancaria</span> 
                                                     </a>
                                                 </li>
                                             </ul>
                                          </div>
                                        </div>
                                 </div>
                                 
                            </div> 
                          <div class="card">
                               <div class="card-body">
                                           
                                 
                              </div>
                          </div>
                       </div>
                            <div class="col-xl-3 col-lg-4">
                                <div class="card">
                                    <div class="card-body">
                                        <h5 class="card-title mb-3" style="text-align: center;">Estado del vendedor</h5>

                                        <form action="/estadoDelVendedor" method="POST"> 
                                             <div class="btn-group me-1 mt-2" style="margin-left: 8%;" >
                                                  <input type="hidden" name="idGenerado" value="= info_vendedor.id_vendedor %>">
                                                  <input type="hidden" name="id_consecutivoVendedor" value="= info_vendedor.id %>">

                                                    <select class="form-select" id="selectEstado" name="estadoElegido">
                                                        <option style="background:gray;color: white;text-transform: capitalize;" class="badge-soft-dark">Estado actual: = viewsUser.estado_de_la_cuenta %></option>
                                                        <br>  
                                                        <option value="aprobado">Aprobado</option>
                                                        <option value="bloqueado">Bloquear</option>
                                                    </select>
                                                </div>
                                               <a href="/perfil-vendedores/= info_vendedor.id_vendedor %>">
                                                    <button class="btn btn-primary" type="submit" 
                                                    style="border-radius: 13px;margin-left: 24%; margin-top: 4%;
                                                    width: 47%;">Guadar</button>
                                                </a> 
                                         </form>
                                       </div>
                                </div>
                                <div class="card">
                                    <div class="card-body">
                                        <h5 class="card-title mb-3" style="text-align: center;">Nivel del vendedor</h5>
                                 
                                            <!-- <form action="/ActualizarNivel" method="POST"> -->
                                         <input type="hidden" id="coodigoActualizarId" name="coodigoActualizarxs" value="= info_vendedor.id_vendedor %>">
                                         <input type="hidden" id="v_individualesId" name="v_individuales" value="= info_vendedor.ventas_individuales%>">
                                         <input type="hidden" id="total_ventasId" name="t_ventas" value="= info_vendedor.total_ventas%>">
                                         <input type="hidden" id="ventas_afiliadosId" name="v_afiliados" value="= info_vendedor.ventas_afiliados%>">

                                              if(info_vendedor.nivel >= 1 && info_vendedor.nivel <= 3 ) { %> 
                                                  if(info_vendedor.nivel == 1) { %> 
                                                    <div class="row justify-content-center">
                                                       <div class="col-md-8">
                                                          <select class="form-select" id="niveles" name="nivel">
                                                             <option style="background:gray;color: white;">Nivel actual: = info_vendedor.nivel %></option>
                                                             <br>
                                                             <option value="2">Subir a nivel 2</option>
                                                          </select>
                                                      </div>
                                                    </div>
                                                   } else if(info_vendedor.nivel == 2) {%> 
                                                    <div class="row justify-content-center">
                                                        <div class="col-md-8">
                                                            <select class="form-select" id="niveles" name="nivel">
                                                              <option style="background:gray;color: white;">Nivel actual: = info_vendedor.nivel %></option>
                                                              <br>
                                                              <option value="3">Subir a nivel 3</option>
                                                            </select>
                                                        </div>
                                                    </div>
                                                   } else if(info_vendedor.nivel == 3) {%> 
                                                    <div class="row justify-content-center">
                                                        <div class="col-md-8">
                                                           <select class="form-select" id="niveles" name="nivel">
                                                             <option style="background:gray;color: white;">Nivel actual: = info_vendedor.nivel %></option>
                                                             <br>
                                                            <option value="4">Subir a nivel 4</option>
                                                          </select> 
                                                        </div>
                                                    </div>
                                                     } %>
                                               <center><button type="button" class="btn btn-primary" onclick="confirmarNuevoNivel()" style="border-radius: 13px;margin-top: 4%; width: 47%;">Guadar</button></center>
                                          }else if(info_vendedor.nivel == 4) {%> 
                                                  <div class="row justify-content-center" style="margin-left: -9%;">
                                                     <div class="col-md-6">
                                                         <div class="form-group ">
                                                            <input type="text" class="form-control" style="background: white;" readonly value="Nivel actual: = info_vendedor.nivel %>">
                                                         </div>
                                                     </div>
                                                  </div>
                                               <input type="hidden" class="btn btn-primary" style="border-radius: 13px;margin-top: 3%;/* font-size: 13px; */" value="Guardar">
                                            }%> 
                                            <!-- </form> -->
                                            <br>
                                            <h2 class="card-title mb-3" style="text-align: center;font-size: 13px;">Número de ventas</h2>
                                            <center>Ventas individuales: <div class="badge badge-soft-info font-size-12" >= info_vendedor.ventas_individuales %></div></center>  
                                            <center>Ventas de afiliados: <div class="badge badge-soft-info font-size-12" >= info_vendedor.ventas_afiliados %></div></center>  
                                            <center>Ventas totales: <div class="badge badge-soft-info font-size-12" >= info_vendedor.total_ventas %></div></center>  
                                       
                                        </div>
                                   <!-- end card body -->
                                </div>
                                <!-- end card -->
                                 if(referente) {%>  
                                    <div class="card">
                                        <div class="card-body">
                                            <h5 class="card-title mb-3">Afiliado a</h5>
                                            <a  href="/perfil-vendedores/- referente.id_vendedor%>" >
                                                <div class="d-flex align-items-center">
                                                    <div class="avatar-sm flex-shrink-0 me-3">
                                                        <img src="../directorio_dash/images/users/avatar-1.jpg" alt="" class="img-thumbnail rounded-circle">
                                                    </div>
                                                    <div class="flex-grow-1" style="text-transform: capitalize;">
                                                        <div>
                                                            <h5 class="font-size-14 mb-1">= referente.nombres %> = referente.apellidos %></h5>
                                                       <p class="font-size-13 text-muted mb-0">- referente.id_vendedor%></p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </a>
                                        </div>
                                        <!-- end card body -->
                                    </div>
                                    <!-- end card -->
                                     } else { %> 
                                        <div class="card">
                                            <div class="card-body">
                                                <h5 class="card-title mb-3">Afiliado a</h5>
                                                    <div class="d-flex align-items-center">
                                                        <div class="flex-grow-1">
                                                            <div>
                                                                <h5 class="font-size-14 mb-1"></h5>
                                                           <p class="font-size-13 text-muted mb-0">Este vendedor no se registró con un código de afiliado</p>
    
                                                           
                                                            </div>
                                                        </div>
                                                    </div>
                                            </div>
                                            <!-- end card body -->
                                        </div>
                                     }%> 

                                    if(info_vendedor.afiliados) {%>  
                                <div class="card">
                                    <div class="card-body">
                                           <h5 class="card-title mb-3">Afiliados</h5>
                                         <div class="list-group list-group-flush">
                                 afiliados.forEach((a)=>{ %> 
                                             <a href="/perfil-vendedores/- a.id_vendedor%>" class="list-group-item list-group-item-action">
                                                <div class="d-flex align-items-center">
                                                    <div class="avatar-sm flex-shrink-0 me-3">
                                                        <img src="../directorio_dash/images/users/avatar-1.jpg" alt="" class="img-thumbnail rounded-circle">
                                                    </div>
                                                    <div class="flex-grow-1" style="text-transform: capitalize;">
                                                        <div>
                                                          
                                                            <h5 class="font-size-14 mb-1">= a.nombres %> = a.apellidos%></h5>
                                                            <p class="font-size-13 text-muted mb-0">= a.id_vendedor%></p>
                                                           
                                                        </div>
                                                    </div>
                                                </div>
                                            </a>
                                              })%> 
                                        </div>
                                    </div>
                                    <!-- end card body -->
                                </div>
                                 } else { %> 
                                    <div class="card">
                                        <div class="card-body">
                                               <h5 class="card-title mb-3">Afiliados</h5>
                                             <div class="list-group list-group-flush">
                                  
                                                  <div class="d-flex align-items-center">
                                                      
                                                        <div class="flex-grow-1" >
                                                            <div>
                                                              
                                                                <h5 class="font-size-14 mb-1"></h5>
                                                                <p class="font-size-13 text-muted mb-0">Este vendedor no tiene afiliados</p>
                                                               
                                                            </div>
                                                        </div>
                                                    </div>
                                            </div>
                                        </div>
                                        <!-- end card body -->
                                    </div>
                                     } %> 
                            </div>
                            <!-- end col -->
                        </div>
                        <!-- end row -->
             
                            </div> <!-- container-fluid -->
                      </div>
                <!-- End Page-content -->

                
      <!-- =======FIXME: copyright ========================== -->
      <%- include ('./partials/copyright.ejs')%>
      <!-- =======FIXME: copyright ========================== -->
            </div>
            <!-- end main content-->

        </div>
      
        <!-- Right bar overlay-->
        <div class="rightbar-overlay"></div>

        <!-- JAVASCRIPT -->
<script src="../directorio_dash/libs/jquery/jquery.min.js"></script>
<script src="../directorio_dash/libs/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="../directorio_dash/libs/metismenu/metisMenu.min.js"></script>
<script src="../directorio_dash/libs/simplebar/simplebar.min.js"></script>
<script src="../directorio_dash/libs/node-waves/waves.min.js"></script>
<script src="../directorio_dash/libs/feather-icons/feather.min.js"></script>
<!-- pace js -->
<script src="../directorio_dash/libs/pace-js/pace.min.js"></script>


<!-- init js -->
<script src="./directorio_dash/js/pages/datatable-pages.init.js"></script>
<script src="../directorio_dash/js/pages/table-responsive.init.js"></script>
<script src="../directorio_perfilClientes/js/app.js"></script>
   
               
<script src="./directorio_dash/js/app.js"></script>
 <!-- Required datatable js -->
 <script src="../directorio_dash/libs/datatables.net/js/jquery.dataTables.min.js"></script>
 <script src="../directorio_dash/libs/datatables.net-bs4/js/dataTables.bootstrap4.min.js"></script>
 <!-- Responsive Table js -->
 <script src="../directorio_dash/libs/admin-resources/rwd-table/rwd-table.min.js"></script>
 <!-- Responsive examples -->
 <script src="../directorio_dash/libs/datatables.net-responsive/js/dataTables.responsive.min.js"></script>
 <script src="../directorio_dash/libs/datatables.net-responsive-bs4/js/responsive.bootstrap4.min.js"></script>


 <!-- Buttons examples -->
 <script src="../directorio_dash/libs/datatables.net-buttons/js/dataTables.buttons.min.js"></script>
 <script src="../directorio_dash/libs/datatables.net-buttons-bs4/js/buttons.bootstrap4.min.js"></script>
 <script src="../directorio_dash/libs/jszip/jszip.min.js"></script>
 <script src="../directorio_dash/libs/pdfmake/build/pdfmake.min.js"></script>
 <script src="../directorio_dash/libs/pdfmake/build/vfs_fonts.js"></script>
 <script src="../directorio_dash/libs/datatables.net-buttons/js/buttons.html5.min.js"></script>
 <script src="../directorio_dash/libs/datatables.net-buttons/js/buttons.print.min.js"></script>
 <script src="../directorio_dash/libs/datatables.net-buttons/js/buttons.colVis.min.js"></script>

   
  <!-- Datatable init js -->
  <script src="../directorio_dash/js/pages/datatables.init.js"></script>    
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.4.8/dist/sweetalert2.all.min.js"></script>

<script>

function confirmarNuevoNivel() {
    let text ="<b>Esta acción no se puede deshacer.</b>"
    Swal.fire({
        title: '<div style="font-weight: 700;"> Subir de nivel a este vendedor</div>',
        html: '<div style="font-size: 16px;font-weight: 200;">Al aumentar el nivel manualmente, el vendedor quedará desvinculado de su afiliado.</div>',
        icon: 'warning',
        footer:'<b style="color:#d33;font-size: 16px;">Esta acción no se puede deshacer.</b>',
        showCancelButton: true,
        confirmButtonColor: '#50368C',
        cancelButtonColor: '#d33',
        cancelButtonText: 'Cancelar',
        confirmButtonText: '¡Sí, subir de nivel!'
    }).then((result) => {
      if (result.isConfirmed) {
            const id_vendedor = $("#coodigoActualizarId").val()
            const nivel = $("#niveles option:selected").val()
            const ventas_individuales = $("#v_individualesId").val()
            const total_ventas = $("#total_ventasId").val()
            const ventas_afiliados = $("#ventas_afiliadosId").val()

            fetch('/ActualizarNivel', {
                method: 'POST',
                body: JSON.stringify({id_vendedor,nivel, ventas_individuales, total_ventas, ventas_afiliados}),
                headers: { 'Content-Type': 'application/json' }
            }).then(res => res.json())
            .catch(error => console.error('Error:', error))
            .then(response => {
                if (response) {
                    location.reload();
                } else {
                    Swal.fire(
                        'Error!',
                        'El nivel no se actualizó correctamente.',
                        'error'
                    )
                }
            });
      }
    })
  }

</script>




</body>
</html>
